<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Wedding RSVP</title>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="Wedding">
        <meta property="og:author" content="Michael Anderson">
        <link rel="stylesheet" href="res/css/wedding.css">
        <script src="res/js/jquery.min.js"></script>
        <script>$(document).ready(function() {
                var hamburger = $('.menu__icon');
                hamburger.click(function() {
                   hamburger.toggleClass('active');
                   return false;
                });
                $('.menu__icon').bind('click', function(){
                    if($('.menu__icon').hasClass('active')){
                        $('.mobile-nav').css({
                            'opacity':'1',
                        });
                        $('nav').css({
                            'box-shadow':'none',
                        });
                    } else {
                        $('.mobile-nav').css({
                            'opacity':'0',
                        });
                        $('nav').css({
                            'box-shadow':'rgba(0,0,0,0.270588) 0px 5px 5px',
                        });
                    }
                })
                $('.mobile-nav a').on('click',function(){
                    $('.mobile-nav').css({
                        'opacity':'0',
                    });
                    $('nav').css({
                      'box-shadow':'rgba(0,0,0,0.270588) 0px 5px 5px',
                  });
                    $('.menu__icon').removeClass('active');
                })
                   
              });
              
              $(document).ready(function(){
                   function scrollNav() {
                    $('nav a').click(function(){  
                      //Toggle Class
                      $(".active-link").removeClass("active-link");      
                      $(this).closest('li').addClass("active-link");
                      var theClass = $(this).attr("class");
                      $('.'+theClass).parent('li').addClass('active-link');
                      //Animate
                      $('html, body').stop().animate({
                          scrollTop: $( $(this).attr('href') ).offset().top - 160
                      }, 400);
                      return false;
                    });
                    $('.scrollTop a').scrollTop();
                  }
                  scrollNav();
              })
              
              $(document).scroll(function(){
                if($(this).scrollTop() > 355) {
                  $('.top').css({
                    'opacity':'1',
                  });
                } else {
                  $('.top').css({
                    'opacity':'0',
                  });
                }
              })
              
            function getUrlVars() {
              var vars = {};
              var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
                vars[key] = value;
              });
              return vars;
            }
            let args = getUrlVars();

            setTimeout(function(){
                document.getElementById('subbtn').onclick = function(){
                    let allergies = document.getElementById('allergies').value;
                    let foodpref = document.getElementById('foodpref').value;
                    let numguests = document.getElementById('numguests').value;
                    let guestname = '';
                    let pfoodpref = '';
                    if (numguests == '2'){
                        guestname = document.getElementById('guestname').value;
                        pfoodpref = document.getElementById('pfoodpref').value;
                    }

                    document.getElementById('subbtn').onclick = function(){}
                    
                    let xhr = new XMLHttpRequest();
                    xhr.open("POST", 'register.php', true);
                    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xhr.onreadystatechange = function() {
                        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
                            console.log(this);
                            DisplayRSVPMsg(String(this.responseText));
                        }
                    }
                    xhr.send("key=" + args.key + "&name=" + args.name + "&allergies=" + allergies + "&foodpref=" + foodpref + "&numguests=" + numguests + "&guestname=" + guestname);
                }
                
                $('#guestpopopt').hide();
                $('#guestpopfopt').hide();
                document.getElementById('numguests').onchange = function(){
                    if (document.getElementById('numguests').value == '2'){
                        $('#guestpopopt').slideDown();
                        $('#guestpopfopt').slideDown();
                    } else {
                        $('#guestpopopt').slideUp();
                        $('#guestpopfopt').slideUp();
                    }}
                }, 100);

            function DisplayRSVPMsg(msg){
                $('.mid').slideUp(400, function(){ $('.mid').remove(); });
                $(msg).hide().appendTo('.divider').slideDown(400);
                $('.divider').css('padding-top', '25px');
                $('#subbtn').fadeOut(400, function(){ $('#subbtn').remove(); });
            }

              </script>
    </head>
    <body>
        <nav role='navigation'>
            <ul>
                <li>
                    <a href="wedding">The Wedding</a>
                </li>
            </ul>
        </nav>
        <div id='nav_offset'></div>
        <div class="header">
            <h1>
                Mike & Tina
            </h1>
            <h2>
                August 17, 2019
            </h2>
        </div>
        <div class="container">
            <div class="shadow i1">
                <div class='input_block'>
                    <div class='mid'>
                        <div class='line'>
                            <label> Attending: </label>
                            <div class="styled-select blue semi-square">
                                <select id="numguests">
                                <option class='test' value="0">Not Attending</option>
                                <option class='test' value="1">Attending</option>
                                <option class='test' value="2">+1</option>
                                </select>
                                </div></div><br></br>
                    
                        <div class='line' id='guestpopopt'>
                            <label> Guest Name: </label><input id="guestname"></input></div>

                        <div class='line'>
                            <label> Food Preference: </label>
                            <div class="styled-select blue semi-square">
                                <select id='foodpref'>
                                <option class='test' value="None">-</option>
                                <option class='test' value="Meat">Meat</option>
                                <option class='test' value="Vegetarian">Vegetarian</option>
                                </select>
                                </div></div><br></br>

                        <div class='line' id='guestpopfopt'>
                            <label> +1 Food Preference: </label>
                            <div class="styled-select blue semi-square">
                                <select id='pfoodpref'>
                                <option class='test' value="None">-</option>
                                <option class='test' value="Meat">Meat</option>
                                <option class='test' value="Vegetarian">Vegetarian</option>
                                </select>
                                </div></div><br></br>          
                                
                        <div class='line'>
                            <label> Allergies: </label><input id="allergies"></input><br></div>
                    </div>
                    <div class='divider'></div>
                    <button id='subbtn'>RSVP</button>
                </div>
            </div>
        </div>
    </body>
</html>